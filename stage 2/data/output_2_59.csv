volume	section	page	text
1	Search API — поиск доступных размещений	1	<br>Search API — поиск доступных размещений<br>=======================================<br><br><br>Ценообразование в TravelLine<br>----------------------------<br><br><br>Отель устанавливает цену на каждый тариф, категорию номера, тип места и дату. Например:<br><br><br>![74f894acdb33783dba47870efafb0764.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/314749/83cf85a36b97399a68421a214bdd08c7.png)<br> <br><br><br>В поиске предоставляются данные на год вперед от текущей даты. Забронировать можно от 1 до 365 ночей.<br><br><br> <br><br><br>Брутто и нетто цены<br>-------------------<br><br><br>Передаются те цены, которые отельер настроит в своём личном кабинете. Мы передаем цены, не зная брутто это или нетто. Наценки и скидки создаются на стороне канала.<br><br><br> <br><br><br>Фильтры в агрегационном поиске<br>------------------------------<br><br><br>В методе search/api/properties/room-stays/search можно указать фильтры:<br><br><br>**По наличию питания** — поле mealPreference.mealType. В запросе можно передать следующие значения:<br><br><br>* All — отображение минимального по стоимости варианта проживания по каждому объекту размещения.<br>* MealOnly — отображение минимального по стоимости варианта проживания с включенным в стоимость тарифа питанием по каждому объекту размещения. Если в объекте размещения отсутствует такой вариант проживания, этот объект размещения не выводится.<br>* MealPriority — отображение минимального по стоимости варианта проживания с включенным в стоимость тарифа питанием по каждому объекту размещения. Если в объекте размещения отсутствуют такие варианты проживания, этот объект размещения также выводится в ответе.<br><br><br>**По типу питания** — поле mealPreference.mealsIncluded. В запросе можно передать значения возможных вариантов питания, которые доступны в ответе метода content/v1/meal-plans, а также в ответе методов content/v1/properties — отображение всей информации о доступных объектах размещения и content/v1/properties{propertyId} — отображение информации по конкретному объекту размещения.  <br><br><br><br>Результат поиска показывает минимальные по стоимости варианты проживания с включенным в стоимость тарифа конкретными типом питания по каждому объекту размещения. Например, если в запросе указать только значения «BreakFast», в ответе можно получить минимальные по стоимости варианты проживания с включенным в стоимость тарифа питанием только типа «BreakFast». При этом в ответе будут отсутствовать варианты «AllInlusive» или «HalfBoard».<br><br><br>Фильтр по типу питания можно использовать только при наличии питания типа «MealOnly» или «MealPriority».<br><br><br>**По минимальной и максимальной стоимости проживания** — поля pricePreference.minPrice и pricePreference.maxPrice.<br><br><br>Эти поля являются необязательными. Если передать значения полей в API, результат поиска покажет варианты проживания с минимальной ценой по всем доступным средствам размещения по выбранным фильтрам.<br><br><br> <br><br><br>Работа с апартаментами<br>----------------------<br><br><br>В агрегационном поиске отображаются варианты проживания с минимальной ценой в рамках апартаментов, которые находятся по разным адресам. Чтобы все апартаменты отображались в агрегационном поиске, необходимо:<br><br><br>* в настройках указать тип объекта размещения — «Апартаменты»;<br>* выбрать режим для квартир и апартаментов, который подключается через службу поддержки TravelLine;<br>* в категориях номеров каждого средства размещения указать свой адрес: город, улица, литера, строение, корпус.<br><br><br>Если у нескольких категорий номеров указан один адрес, считается, что эти категории номеров размещаются в одном здании и в агрегационном поиске по таким категориям номеров отобразится один вариант проживания с минимальной ценой.<br><br><br>![0831482f7e4222aa87b7fd17d1d96d5b.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/314749/651f1244dd52ead133a077ecb4d997ea.png)<br> <br><br><br>Передается ли НДС<br>-----------------<br><br><br>В теле ответа на создание и чтение брони содержатся поля:<br><br><br>* НДС проживания — booking.roomstays[].ratePlan VAT;<br>* НДС услуг — booking.roomstays[].services[] VAT.<br><br><br> <br>Налоги и сборы (кроме НДС)<br>--------------------------<br><br><br>Поле taxAmount содержит сумму налогов и сборов, которую оплачивает гость при заезде согласно законодательству РФ (НДС не содержит). Например:<br><br><br>* Федеральный закон № 214-ФЗ от 29 июля 2017 года;<br>* Закон Краснодарского края № 3690-КЗ от 27.11.2017.<br><br><br> <br><br>Тип питания в размещении RoomStay<br>---------------------------------<br><br><br>Для одного RoomStay доступно только одно питание. В системе TravelLine отель может добавить в тариф только одну услугу с типом питания. Поэтому mealPlanCode является строковым типом данных.<br><br><br> <br><br><br>Что делать, если запрос в «api/search/v1/properties/ {propertyId}/room-stays» не содержит ошибок и на него не приходит ответ<br>----------------------------------------------------------------------------------------------------------------------------<br><br><br>![7143857b14e63d7d55faed5d21d5c791.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/314749/92ed8048bc139fa8b53205a09a5ec1f8.png)<br> <br><br><br>Обратите внимание на поля «arrivalDate» и «departureDate» — в них должны быть указаны даты в будущем:<br><br><br>![04a362c7e2e7724d9d8a0a563062fab9.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/314749/4eded6f37e1ed49b65c6877e52137e57.png)<br> <br><br><br>Расселение гостей в номере<br>--------------------------<br><br><br>В результатах поиска возвращаются поля:<br><br><br>* roomStays.fullPlacementsName;<br>* roomStays.roomType.placements.<br><br><br>В placements перечислены не конкретные места, а типы условий для размещения гостей. В ответе видно, что два взрослых размещаются на основных местах, ребенок в возрасте 2 года на основном месте, а ребенок в возрасте 5 лет на дополнительном месте.<br><br><br>![cac2afb163c0a4a1bf037cde5e3588fe.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/314749/fe7ae2ea71f25826a81555a648593061.png)<br> <br><br><br>Дети могут размещаться на взрослых местах — это происходит, если нет специальных условий для размещения детей или нет свободных детских мест. В таких случаях дети размещаются по цене взрослого размещения.<br><br><br> <br><br><br>Расшифровка дополнительного места<br>---------------------------------<br><br><br>Расшифровки дополнительных мест нет. Поэтому нельзя узнать — диван это или, например, детская кроватка.<br><br><br> <br><br><br>Блоки доступности номеров<br>-------------------------<br><br><br>В результатах поиска вариантов размещений доступность зависит от выбранного отельером блока доступности в каждом тарифном плане. Подробности читайте в статье «[Как работать с разными блоками доступности номеров](https://www.travelline.ru/support/knowledge-base/?id=281945)». Тарифы передаются в каналы продаж только по одному блоку доступности.<br><br><br><br>Правила отмены бронирований<br>---------------------------<br><br><br>В каналы продаж передаются[правила отмены бронирований](https://www.travelline.ru/support/knowledge-base/?id=282453), настроенные в личном кабинете TravelLine. Сумма штрафа может быть разной в зависимости от даты отмены, если у средства размещения настроены различные условия отмены.<br><br><br>В результатах поиска возвращаются следующие поля:<br><br><br>* roomStays.cancellationPolicy.freeCancellationPossible;<br>* roomStays.cancellationPolicy.freeCancellationDeadline;<br>* roomStays.cancellationPolicy.penaltyAmount.<br><br><br>В зависимости от полученных значений в полях правила отмены интерпретируются так.<br><br><br>Бронирование является невозвратным, при этом штраф за отмену на текущую дату составляет 4000 (в последующие даты размер штрафа может быть другим), при получении следующих значений: <br><br><br>* freeCancellationPossible = false;<br>* freeCancellationDeadline = null;<br>* penaltyAmount = 4000.<br><br><br>Отмена бронирования бесплатна до 30.09.2023 12:00. После этого времени штраф за отмену составит 4000 (в последующие даты размер штрафа может быть другим), при получении следующих значений:<br><br><br>* freeCancellationPossible = true;<br>* freeCancellationDeadline = 2023-09-30T12:00;<br>* penaltyAmount = 4000.<br><br><br>Штраф за отмену не взимается при отмене в любую дату, при получении следующих значений:<br><br><br>* freeCancellationPossible = true;<br>* freeCancellationDeadline = null;<br>* penaltyAmount = null.<br><br><br>  <br><br><br>Статистика времени ответа на запросы<br>------------------------------------<br><br><br>Поиск вариантов проживаний по конкретному средству размещения:<br><br><br>* 90 pt — 866 ms;<br>* 95 pt — 1050 ms.<br><br><br>Поиск вариантов проживания с минимальной ценой по всем доступным средствам размещения:<br><br><br>* 90 pt — 1111 ms;<br>* 95 pt — 1728 ms.<br>
