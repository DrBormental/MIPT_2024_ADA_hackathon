volume	section	page	text
1	Интеграция TL: WebPMS и 1С	1	"<br>Интеграция TL: WebPMS и 1С<br>==========================<br><br><br>Набор программных продуктов компании 1С предназначен для автоматизации бухгалтерского и налогового учета, для работы с отчетностью. Это профессиональный инструмент бухгалтера, которым пользуется большое количество наших партнеров, пользователей [TL: WebPMS](https://www.travelline.ru/products/webpms/). Чтобы было удобно работать с документами в привычной среде, мы разработали API для интеграции TL: WebPMS и 1С.<br><br><br> <br><br><br>Как работает API<br>----------------<br><br><br>API помогает TL: WebPMS и 1C обмениваться данными. Вам не придется вручную переносить и создавать документы — достаточно один раз настроить связку через API.<br><br><br>Из TL: WebPMS в 1C передаются:<br><br><br>* начисления по броням за проживание и платные услуги;<br>* начисления от продажи услуг, которые не связаны с проживанием;<br>* наличные платежи и платежи банковской картой, оформленные в шахматке.<br><br><br>На основе этих данных в 1С могут создаваться различные документы:<br><br><br><br><br>| **TL: WebPMS** | **1С** |<br>| --- | --- |<br>| Начисления | Счета, акты выполненных работ (реализация товаров и услуг), счета-фактуры. |<br>| Наличные платежи | Приходные кассовые ордеры и расходные кассовые ордеры для возврата денежных средств. |<br>| Электронные платежи | Документы «Операции по платежным картам» и «Поступление на расчетный счет». |<br><br><br> <br><br><br>Примеры документов, которые создаются в 1С:  <br><br><br><br>![0f00004d4cf45a1c951deaff0aa603e6.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/89bd11e8e6949c4ee54778c03d5be59f.png)<br> <br><br><br>![c55c53d2f9eabb7b4c57190faa0b77df.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/03f246f0f197b4c4e825932f0888e4cb.png)<br> <br><br><br>Поступления на расчетный счет гостиницы выгружаются из 1С в TL: WebPMS в виде платежей по брони. Чтобы документ «Поступление на расчетный счет» выгрузился в TL: WebPMS и привязался к брони, выберите документ-основание в выписке. Документ-основание — это счет на оплату, который ранее был загружен из TL: WebPMS.<br><br><br>Если по какой-то причине платеж не привязался к брони автоматически, то он оказывается в списке «Недоставленные платежи». Смотрите подробности в статье «[Как обрабатывать платежи недоставленные из 1С](https://www.travelline.ru/support/knowledge-base/?id=281770)».<br><br><br> <br><br><br>Как настроить интеграцию<br>------------------------<br><br><br>**Модуль интеграции**  <br><br><br><br>Мы понимаем, что не в каждой гостинице есть 1С разработчик. Поэтому мы создали специальной модуль для взаимодействия 1С с API. <br><br><br>Стоимость модуля — от 20000 рублей. Для подключения отправьте запрос на [salesplus@travelline.ru](mailto:salesplus@travelline.ru ""mailto:salesplus@travelline.ru"").<br><br><br>  <br>**Самостоятельная разработка модуля** <br><br><br>Это возможно через API, который работает на [тарифе PREMIUM](https://www.travelline.ru/products/webpms/#price ""https://www.travelline.ru/products/webpms/#price""). Напишите нам на [salesplus@travelline.ru](mailto:salesplus@travelline.ru), чтобы подключить этот тариф. После заключения договора мы предоставим описание API TL:WebPMS вашему техническому специалисту для разработки и настройки модуля. <br><br><br> <br><br><br>Какие версии 1С поддерживает модуль<br>-----------------------------------<br><br><br>Платформа 1С 8.3 (управляемое приложение):<br><br><br>* Бухгалтерия предприятия, ред. 3.0 (3.0.73 и выше);<br>* Бухгалтерия предприятия КОРП, ред. 3.0 (3.0.73 и выше).<br><br><br>Платформа 1С 8.2 и 8.3:<br><br><br>* Бухгалтерия предприятия 2.0, ред. 2.0.66 (2.0.66.86 и выше);<br>* Бухгалтерия предприятия КОРП 2.0, ред. 2.0.66 (2.0.66.86 и выше);<br>* Управление производственным предприятием, ред. 1.3 (1.3.127 и выше).<br><br><br>Это самые распространенные версии 1С. Если вы используете специфическую версию или конфигурация, то для подключения модуля могут потребоваться доработки за дополнительную плату. Чтобы узнать все подробности пишите по адресу [salesplus@travelline.ru](mailto:salesplus@travelline.ru).<br><br><br>  <br><br><br>Как установить модуль<br>---------------------<br><br><br>Вам потребуются права на подключение внешних обработок в 1С. Модуль внешней обработки не вносит изменений в конфигурацию 1С, при установке база данных останется нетронутой.<br><br><br>1. Получите модуль интеграции и API Key от сотрудника TravelLine. Пишите по адресу [salesplus@travelline.ru](mailto:salesplus@travelline.ru).<br><br><br>2. На странице «Администрирование» откройте пункт «Печатные формы, отчеты и обработки»:<br><br><br>![d35a28a3b0e49ef1e1e5f9e59ad2c7fd.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/add36b92f0c3284509068c11f8a2e160.png)<br> <br><br><br>3. Откройте «Дополнительные отчеты и обработки»:<br><br><br>![39e8729fcd07310cdda0ed14fc79ffbd.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/0be7e49ab1f6c05fe540aa25c7a68983.png)<br> <br><br><br>4. Нажмите на кнопку «Добавить из файла...»:<br><br><br>![16d414f6a4e915adea735a1a5cdb8b21.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/5d2a0d54b08b9157b429d63729c9a6d5.png)<br> <br><br><br>5. Откроется окно «Предупреждение безопасности». Нажмите на кнопку «Продолжить»:<br><br><br>![4906c53e72fa65379e58f1a25d7212fa.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/c2234b9bd03ad4e536942c8fc7d37110.png)<br> <br><br><br>6. Откройте файл, который передал вам сотрудник TravelLine:<br><br><br>![4efc202f8ff1fe73e12e8f7a5ef75b1b.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/5f0ac263040d4a14b3131a523e951e6f.png)<br> <br><br><br>7. Настройте размещение:<br><br><br>![9b35f5e97af8320ae2db34c9163fb284.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/617e48e649bb022b5f052ed2936d5e85.png)<br> <br><br><br>8. Выберите размещение в разделах «Администрирование», «Продажи» и нажмите на кнопку «ОК»:<br><br><br>![4810329736f5b830598077a7fb3979a9.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/5b63e6b9ed0290f3f4ef93bebf1a28d5.png)<br> <br><br><br>9. Настройте быстрый доступ:<br><br><br>![ff3c4678aed6d9a25ee56813b523eb88.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/9000a024f82dc950bada17f0d5d5216f.png)<br> <br><br><br>10. Добавьте пользователей, которые будут работать с модулем и нажмите на кнопку «ОК»:<br><br><br>![26eabd419b546e4650b44ae1453a3757.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/0f46223e4c062fa37dc3bcba0d94016a.png)<br> <br><br><br>Как запустить модуль<br>--------------------<br><br><br>1. На странице «Продажи» откройте сервис «Дополнительные обработки»:<br><br><br>![ebc0286f35cfc6d8dd56ac933d53fcd4.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/ea813510023ecc8f3ee0b279de7235fe.png)<br> <br><br><br>2. В открывшемся окне нажмите «Настроить список»:<br><br><br>![cb1e3f23689a7ae0569ff6feabf5ad15.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/f2ca3601abf99fb36e825ebee01835d8.png)<br> <br><br><br>3. Выберите модуль «Интеграция 1С с TL: WebPMS» и нажмите на кнопку «OK»:<br><br><br>![b0b6ef8f54711f0c8860bd6987c68fae.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/dea414ee4bdac4f76c325c9588b254de.png)<br> <br><br><br>4. Нажмите на кнопку «Выполнить»:<br><br><br>![936b8c912d2d08ac8d7848050cf4871e.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/dc76dfa29b59b7b62de2c25467623032.png)<br> <br><br><br>5. Модуль готов к работе:<br><br><br>![04cc0149ef11f26108736beb5fc5adb4.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/2236b6758c8a3e09a0b0dd60bab7d1b9.png)<br> <br><br><br>Как настроить модуль<br>--------------------<br><br><br>На вкладках «Основные», «Настройки по документам» и «Настройки по оплатам» находятся параметры загрузки данных из TL: WebPMS в 1С.<br><br><br>**Вкладка «Основные»**<br><br><br>![9321c73c818615348a6e2d59ba7adb30.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/b631a1af8c12ce0dba7e27079f4320ca.png)<br> <br><br><br>«Период загрузки» — промежуток времени для загрузки и выгрузки данных. Эта настройка дублируется на каждой вкладке.<br><br><br>«API Key» — ключ для работы модуля через API выдается сотрудником TravelLine. Вставьте ключ и нажмите на кнопку «Проверить API key». Вы увидите сообщение о готовности API к работе.<br><br><br>«Организация для загрузки» — юридическое лицо гостиницы.<br><br><br>«Банковский счет» — основной банковский счет юридического лица, на который приходят все документы.<br><br><br>«Выставлять документы на каждое физлицо» — при отключении опции выбирается одно общее физическое лицо для выставления всех документов физических лиц:<br><br><br>![b26d9834f52c72de88f86c78c20e778d.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/fe43b92e9e35001a77c52ba259abcb91.png)<br> <br><br><br>Документы для юридических лиц выставляются на каждое юридическое лицо отдельно.<br><br><br>«Валюта по умолчанию» — выберите валюту учета.<br><br><br>«Создавать ненайденных контрагентов» — поиск в базе происходит по ИНН, КПП и наименованию. Если данные не находятся, то добавляется новый контрагент. При отключении опции в документах не будет контрагента.<br><br><br>«Группа для новых контрагентов» — вы можете выбрать папки, куда будут добавляться новые юридические и физические лица.<br><br><br>«Группа для новой номенклатуры» — если из TL: WebPMS приходит услуга, которой нет в 1С, то для услуги создается новая номенклатура. В этой настройке выбирается папка для новой номенклатуры.<br><br><br>«Единица для новой номенклатуры» — выберите единицу измерения.<br><br><br>«Поиск номенклатуры в выбранной папке» — при выборе опции модуль будет искать номенклатуру в указанной папке. Если настройка не выбрана, то поиск будет проходить по всей базе.<br><br><br>«Проводить документы» — документы из TL: WebPMS будут проводиться автоматически. Если вы хотите проводить документы вручную, снимите галочку.<br><br><br> <br><br><br>**Вкладка «Настройки по документам»**<br><br><br>![3ee77301044b873b4e462bfd134a7579.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/8178378fb22558a9d8680f0574d03b56.png)<br> <br><br><br>«Тип выгрузки по дате» — выберите признак, по которому из TL: WebPMS будут выгружаться документы:<br><br><br>* «по выезду» — выгружается информация о бронях, дата выезда которых попала в запрашиваемый период. Обычно используется для загрузки актов и счетов.<br>* «по пребыванию» — выгружается информация о начислениях, которые были сделаны в запрашиваемый период. Обычно используется для загрузки актов.<br>* «создание брони» — выгружается информация о бронях, созданных в запрашиваемый период.<br><br><br>«Загружать каждую услугу отдельно» — каждая услуга (проживание, дополнительные услуги, ранний заезд, поздний выезд и трансферы) будет загружена отдельной строкой в акте. Если настройка не выбрана, то в акте будет одна общая услуга.<br><br><br>При выборе этой настройки появляется опция «Группировать услуги в документах» — повторяющиеся услуги будут сгруппированы:<br><br><br>![56f0df2654268ece028bd9c642646dac.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/f6fab12fa0301cf53bd0370d388103b2.png)<br> <br><br><br>Чтобы все услуги загружались в виде одной номенклатуры, снимите галочку. В этом случае выберите документ для загрузки:<br><br><br>![7e303eb84fbd46c7f8c0f04507939e09.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/b2e32a8fd7e71cd835027f25ede05845.png)<br> <br><br><br>«Не создавать акт для физ лица» и «Не создавать счет на оплату для физ лица» — поставьте галочки, чтобы не загружать документы для физических лиц.<br><br><br>«Создавать счет на оплату для физ лица от компании-агента» — счет на оплату физическим лицам будет выставляться для услуг, оказанных компанией-агентом.<br><br><br>При выборе этой настройки появятся опция «Выставлять счет на оплату для физ лица на компанию-агента» — в качестве плательщика в счете будет указана компания-агент.<br><br><br>![dc8801539c8e6e59e05947794d87fce2.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/a88942bcc22a1f445ddae93cee1f7bed.png)<br> <br><br><br>«Устанавливать номер акта из WebPMS» — номер акта будет копироваться из TL: WebPMS в 1С.<br><br><br>«Устанавливать номер счета на оплату из WebPMS» — номер счета будет копироваться из TL: WebPMS в 1С.<br><br><br>«Выставлять счет текущей датой» — в счете будет выбрана текущая дата на момент передачи информации, а не дата создания брони.<br><br><br>«Загружать только, когда заезд гостя зафиксировать» — из TL: WebPMS будут загружаться только те брони, по которым гость заселился в номер.<br><br><br>«Сумма включает НДС» — НДС будет входить в стоимость услуги.<br><br><br>«Создавать счет-фактуру» — настройка для организаций, которые работают с НДС.<br><br><br>«Общий счет, акт, платеж для групповой брони» — для групповой брони будет создаваться общий пакет документов всех броней группы.<br><br><br>«Не выставлять акт с оплатой без чека» — брони, оплаченные без чека, не попадут в 1C.<br><br><br>«Не обновлять проведенные документы» — документы загруженные и проведенные ранее не будут обновляться при загрузке из TL: WebPMS.<br><br><br>Номенклатура для печатной формы счета и акта формируется при помощи шаблонов:<br><br><br>![d2476a90c761b8c82b12412690669a4a.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/e81e870aafac7e7c3efc3881c5793377.png)<br> <br><br><br>Соберите свои шаблоны при помощи переменных в квадратных кавычках. При печати документов переменные автоматически заменяются на реальные данные из брони.<br><br><br>«Настройки прокси» — если вы используете прокси-сервер, введите его данные.<br><br><br>![8c28e768bd74f31e2018b63a76e1139a.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/6041245b3db82deab5e6d731e077cf15.png)<br> <br><br><br>**Вкладка «Настройки по оплатам»**<br><br><br>![b771eee91f3c9c253a9efdcb32dadffd.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/1e1777600a7807868e2b38545224656b.png)<br> <br><br><br>Выберите типы и методы оплаты, которые будет обрабатывать модуль. Наличные платежи оформляются в виде приходных кассовых ордеров, возвраты в виде расходных кассовых ордеров. Электронные платежи в виде оплаты платежной картой или возврата.<br><br><br>«Электронный платеж загружать в документ “Оплата платежной картой”» — чтобы электронный платеж загружался в выписку, а не в оплату платежной картой, снимите галочку.<br><br><br>«Загружать электронный платеж по юр лицам» — электронные платежи обычно загружаются через клиент-банк. Чтобы загружать их через модуль, поставьте галочку.<br><br><br>«Поиск документов при загрузке» — опция сравнивает все документы по дате создания, номеру брони и контрагенту. Благодаря этому дубликаты документов не создаются.<br><br><br>«Загружать платежи только с чеками» — поставьте галочку, чтобы не загружать платежи без чеков.<br><br><br>«Группировать платежи по счету, без разделения по ключевым услугам» — если в TL: WebPMS несколько услуг в одной брони, то в 1С загружается несколько платежей. Чтобы сгруппировать эти платежи в одну оплату, поставьте галочку.<br><br><br>Данные блока «Заполнение документов» используются в качестве реквизитов в документе на оплату по умолчанию. Введите свои данные из плана счетов бухгалтерского учета.<br><br><br> <br><br><br>**Вкладка «Выгрузка платежей»**<br><br><br>Параметры выгрузки данных из 1С в TL: WebPMS:<br><br><br>![d192661bdb8c9507b17c68c196dcc570.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/75af220ba4d5c1f2a585783e1a5a71d2.png)<br> <br><br><br>Вы можете выбрать для выгрузки вид операции, банковский счет и статью доходов.<br><br><br>«Выгружать платежи по расшифровкам» — платежи будут выгружаться отдельно для каждой расшифровки из документа «Поступление на расчетный счет».<br><br><br>«Отбирать выписки по выставленным счетам, товары в счете на оплату должны быть из группы товаров в настройках» — в TL: WebPMS будут выгружаться только платежи, которые основаны на счетах с услугами из настройки «Группа для новой номенклатуры» на вкладке «Основные».<br><br><br> <br><br><br>**Экспорт и импорт настроек**<br><br><br>Вы можете экспортировать и импортировать все настройки модуля. Функция будет полезна для работы нескольких пользователей в одной организации и поможет при физическом перемещении базы данных 1С.<br><br><br>![9955b649e06fbfc9ef9e1b4dfdd376a9.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/68c88b2045a00405f2a2c5ac76f3bbe8.png)<br> <br><br><br>Как загружать и выгружать документы<br>-----------------------------------<br><br><br>Загрузка данных в 1С происходит по нажатию кнопок:<br><br><br>* «Акты» — загружаются документы «Реализация товаров и услуг»;<br>* «Счета» — загружаются документы «Счет на оплату покупателя»;<br>* «Платежи» — загружаются наличные и электронные платежи.<br><br><br>По нажатию на кнопку «Выгрузить платежи в TL: WebPMS» из 1С выгружаются поступления по расчетному счету.<br><br><br>![8f014c31cff33f9a951f43dd733b252e.png](https://138018.selcdn.ru/KB_images/omnideskru/10578/313450/bedca8a897dd2615d454dd456b1a3b61.png)<br> <br><br><br>Данные обрабатываются в соответствии с настройками, которые вы установили на вкладках. При повторной загрузке или выгрузке данные перезаписываются новой информацией.<br><br><br><br><br>"
